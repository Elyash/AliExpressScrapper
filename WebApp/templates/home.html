{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}

    <div class="home-container">
        <h1>Welcome to Your Gifts!</h1>
        
        <div class="gift-input-container">
            <form method="POST" action="{{ url_for('home') }}">
                <input type="text" name="gift_link" placeholder="Enter a new gift link" required>
                <button type="submit" class="btn">Submit</button>
            </form>
        </div>
        <h2>My Wish List</h2>
        <div class="carousel-container">
            <button class="arrow left-arrow" onclick="previousPane()">&#10094;</button>
            <div class="carousel">
                <div class="gift-list">
                    {% for gift in user_gifts %}
                        <div class="gift-card" onclick="handleGiftClink()">
                            <button class="delete-btn" onclick="deleteGift(event)">X</button>
                            <img src="{{ gift['gift_image'] }}" class="gift-image">
                            <div class="gift-details">
                                <h3 class="gift-name">{{ gift['gift_name'] }}</h3>
                                <p class="gift-price">{{ gift['gift_price'] }}</p>
                            </div>
                        </div>
                        <script>
                            function handleGiftClink() {
                                window.open("{{ gift['link'] }}", "_blank")
                            }
                            function deleteGift(event) {
                                const giftId = "{{ gift['_id'] }}";

                                event.stopPropagation();
                                // Make AJAX call to delete the gift
                                fetch(`/delete_gift/${giftId}`, {
                                    method: 'DELETE'
                                }).then(() => {
                                    window.location.reload();
                                });
                            }
                        </script>
                    {% endfor %}
                </div>
            </div>
            <button class="arrow right-arrow" onclick="nextPane()">&#10095;</button>
            <script>
                let currentPane = 0;
    
                function updateCarousel() {
                    const carousel = document.querySelector('.carousel');
                    const panes = document.querySelectorAll('.gift-card');
                    const totalPanes = panes.length;
                    
                    // Ensure the currentPane index is within bounds
                    if (currentPane < 0) {
                        currentPane = totalPanes - 3; // Move to last batch of 3 panes
                    } else if (currentPane >= totalPanes - 2) {
                        currentPane = 0; // Move to first batch
                    }
    
                    // Translate the carousel to the correct set of 3 panes
                    carousel.style.transform = `translateX(-${currentPane * 30}%)`;
                }
    
                function nextPane() {
                    currentPane++;
                    updateCarousel();
                }
    
                function previousPane() {
                    currentPane--;
                    updateCarousel();
                }
            </script>
        </div>
    </div>

{% endblock %}
